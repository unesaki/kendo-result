= ログ出力API 処理詳細設計書

== 対象API
POST /api/logout

== Bean定義

=== 種別一覧

[cols="1,1,2", options="header"]
|===
| 種別 | 名称              | 補足

| DTO  | LogoutRequestDto  | ログアウトリクエスト用DTO（トークンなどを含む場合）
| DTO  | CommonResponseDto | 汎用レスポンスDTO（成功/失敗メッセージ等）
|===

=== LogoutRequestDtoのフィールド定義（必要に応じて）

[cols="1,1,1,1", options="header"]
|===
| 論理名 | 物理名 | 型     | バリデーションルール

| トークン | token | String | 必須（ヘッダーで受け取る場合は不要）
|===

=== CommonResponseDtoのフィールド定義

[cols="1,1,1,1", options="header"]
|===
| 論理名     | 物理名   | 型     | バリデーションルール

| ステータス | status   | String | -
| メッセージ | message  | String | -
|===

==== バリデーションエラーハンドリング定義（必要な場合）

[cols="1,1,1,1", options="header"]
|===
| 原因              | エラーメッセージID     | HTTPステータス | パラメータ

| トークンが未指定   | E_VAL_MSG_0001         | 400             | token
|===

== Controller定義

=== クラス名
AuthController

=== フィールド一覧

[cols="1,1,1", options="header"]
|===
| フィールド名 | 型            | 内容

| authService  | AuthService   | @Autowired によりDIコンテナからインジェクトされる
|===

=== アノテーション一覧

[cols="1,1", options="header"]
|===
| 対象     | アノテーション

| クラス   | @RestController, @RequestMapping("/api")
| メソッド | @PostMapping("/logout")
|===

=== パラメータアノテーション一覧（リクエストボディがある場合）

[cols="1,1", options="header"]
|===
| パラメータ             | アノテーション

| LogoutRequestDto request | @RequestBody
|===

=== メソッド一覧

[cols="1,1,1", options="header"]
|===
| メソッド名 | 戻り値型                  | パラメータ

| logout     | ResponseEntity<CommonResponseDto> | LogoutRequestDto request（必要に応じて）
|===

=== 処理詳細

[cols="1,2", options="header"]
|===
| 番号 | 処理内容

| 1 | クライアントから受け取ったトークンを元に、認証情報を無効化する。
| 2 | 無効化処理後、成功メッセージを含む CommonResponseDto を返却する。
| 3 | 処理中に例外が発生した場合は、下記のエラーハンドリング定義に従って適切なレスポンスを返却する。
|===

==== エラーハンドリング定義

[cols="1,1,1,1", options="header"]
|===
| 原因                    | HTTPステータス            | エラーメッセージID   | パラメータ

| トークンが無効または期限切れ | 401 Unauthorized         | E_AUTH_MSG_0003         | token
| サーバー内部エラー           | 500 Internal Server Error | E_SYS_MSG_0002          | -
|===

== Service定義

=== クラス名
AuthService

=== フィールド一覧

[cols="1,1,1", options="header"]
|===
| フィールド名     | 型                  | 内容

| tokenBlacklistService | TokenBlacklistService | トークン無効化処理用（任意）
|===

=== アノテーション一覧

[cols="1,1", options="header"]
|===
| 対象 | アノテーション

| クラス | @Service
|===

=== メソッド：logout

[cols="1,1,1", options="header"]
|===
| メソッド名 | 戻り値型              | パラメータ

| logout     | CommonResponseDto     | LogoutRequestDto request（またはトークン）
|===

==== 処理詳細

[cols="1,2", options="header"]
|===
| 番号 | 処理内容

| 1 | トークンが有効かを確認し、ブラックリストに登録するなどの方法で無効化する。
| 2 | 成功レスポンスを生成して返却する。
| 3 | 例外が発生した場合は、500エラーと `E_SYS_MSG_0002` を返却する。
|===
